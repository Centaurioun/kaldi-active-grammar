#
# This file is part of kaldi-active-grammar.
# (c) Copyright 2019 by David Zurow
# Licensed under the AGPL-3.0, with exceptions; see LICENSE.txt file.
#

import re


class Lexicon(object):

    CMU_to_XSAMPA_dict = {
        "'"   : "'",
        'AA'  : 'A',
        'AE'  : '{',
        'AH'  : 'V',  ##
        'AO'  : 'O',  ##
        'AW'  : 'aU',
        'AY'  : 'aI',
        'B'   : 'b',
        'CH'  : 'tS',
        'D'   : 'd',
        'DH'  : 'D',
        'EH'  : 'E',
        'ER'  : '3',
        'EY'  : 'eI',
        'F'   : 'f',
        'G'   : 'g',
        'HH'  : 'h',
        'IH'  : 'I',
        'IY'  : 'i',
        'JH'  : 'dZ',
        'K'   : 'k',
        'L'   : 'l',
        'M'   : 'm',
        'NG'  : 'N',
        'N'   : 'n',
        'OW'  : 'oU',
        'OY'  : 'OI', ##
        'P'   : 'p',
        'R'   : 'r',
        'SH'  : 'S',
        'S'   : 's',
        'TH'  : 'T',
        'T'   : 't',
        'UH'  : 'U',
        'UW'  : 'u',
        'V'   : 'v',
        'W'   : 'w',
        'Y'   : 'j',
        'ZH'  : 'Z',
        'Z'   : 'z',
    }
    CMU_to_XSAMPA_dict.update({'AX': '@'})
    del CMU_to_XSAMPA_dict["'"]
    XSAMPA_to_CMU_dict = { v: k for v,k in CMU_to_XSAMPA_dict.items() }
    cmu_stress_regex = re.compile(r'(0|1|2)$')

    @classmethod
    def cmu_to_xsampa(cls, phones):
        # cmu_stress_repl = lambda matchobj: "'" if matchobj.group() == '1' else ''
        def repl(phone):
            stress = False
            if phone.endswith('1'):
                phone = phone[:-1]
                stress = True
            elif phone.endswith(('0', '2')):
                phone = phone[:-1]
            return ("'" if stress else '') + cls.CMU_to_XSAMPA_dict[phone]
        # return [cls.CMU_to_XSAMPA_dict[cls.cmu_stress_regex.sub(cmu_stress_repl, phone)] for phone in phones]
        return [repl(phone) for phone in phones]


class Model(object):
    def __init__(self, model_dir):
        self.dir = os.path.join(model_dir, '')

    @staticmethod
    def add_word(word, phones):
        phones = Lexicon.cmu_to_xsampa(phones)
